<% presenter = GamePresenter.new(game:) %>

<% if game.running? %>
  <div id="<%= dom_id(game) %>" class="game grid gap-0" style="grid-template-columns: repeat(<%= Game::World::WIDTH%>,minmax(0,1fr));">
    <% presenter.rows.each_with_index do |row, row_index| %>
      <% row.each_with_index do |cell, cell_index| %>
        <%=
          game_cell(cell,
                    presenter.player_at?(row_index, cell_index),
                    cell == Game::World::PATTERN_RAILWAY && presenter.train_position == cell_index)
        %>
      <% end %>
    <% end %>
  </div>
<% else %>
  <div id="<%= dom_id(game) %>" class="w-4/5 mx-auto bg-opacity-70 bg-black p-8 pb-16" data-controller="gameover">
    <% if game.winner %>
      <div class="text-center mb-12 text-white">
        <h2 id="winner_indicator" data-winner-identity="<%= game.winner.identity %>"></h2>
        <h3 id="winner_description">Take a look at the rest of the story</h3>
      </div>

      <div class="grid grid-cols-1 gap-4 text-center">
        <%= image_tag("frogger_winner_1000.jpeg", alt: "Game outro slide 1 - kissing the frog", class: 'mx-auto w-1/2 js-successful-mission') %>
        <%= image_tag("frogger_winner_2000.jpeg", alt: "Game outro slide 2 - resting", class: 'mx-auto w-1/2 js-successful-mission') %>
        <%= image_tag("frogger_winner_3000.jpeg", alt: "Game outro slide 3 - putting wizard to jain", class: 'mx-auto w-1/2 js-successful-mission') %>
        <%= image_tag("frogger_winner_4000.jpeg", alt: "Game outro slide 4 - happily ever after", class: 'mx-auto w-1/2 js-successful-mission') %>

        <%= image_tag("frog_looking_into_distance.jpeg", alt: "Game outro slide - frog looking into distance", class: 'mx-auto w-1/2 js-failed-mission hidden') %>
      </div>
    <% else %>
      <div class="text-center mb-12">
        <h2>Better luck next time Prince...</h2>
        <h3>The Princess was kidnapped and the Prince was eating flies for the rest of his days</h3>
      </div>
      <div class="w-4/5 mx-auto text-justify">
        <%= image_tag("frog_looking_into_distance.jpeg", alt: "Game outro slide - frog looking into distance", class: 'mx-auto w-2/3 ') %>
      </div>
    <% end %>
  </div>
<% end %>
